# Операционные системы. ИДЗ №3. Вариант 29.

#### Выполнил Старцев Евгений Борисович, БПИ219.

## Условие

Первая военная задача. Темной–темной ночью прапорщики Иванов, Петров и Нечепорук занимаются хищением военного имущества
со склада родной военной части. Будучи умными людьми и
отличниками боевой и строевой подготовки, прапорщики ввели разделение труда. Иванов выносит имущество со склада и
передает его в руки Петрову, который грузит его в грузовик. Нечепорук стоит на
шухере и заодно подсчитывает рыночную стоимость добычи после погрузки в грузовик очередной партии похищенного. Требуется
создать приложение, моделирующее деятельность прапорщиков. Время выполнения каждого действия прапорщиков - процессов
задавать случайным образом.

## Отчёт

### Задание выполнено на 4-5 баллов

## Как всё это дело запустить

В терминале нужно прописать следующие команды:

```
// в одном терминале - для компиляции программ
gcc -o server server.c -pthread
gcc -o client client.c
```

Программу сервера необходимо компилировать с `pthread`, так как программа была написана с применением потоков для
возможности отправлять на сервер запросы нескольким клиентам с разных терминалов.

Далее необходимо запустить программы в разных терминалах:

Запуск сервера:

```
./server 8000
```

где 8000 - порт. Программу сервера можно запустить только на локалхосте

Запуск клиента (клиентов):

```

./client localhost 8000

```

где localhost - адрес, 8000 - порт.

Если вдруг порт 8000 не срабатывает - попробуйте 8080. Я тестировал на реальной Ubuntu 22.04, срабатывало)

## Решение на 4-5 баллов

Немного про само решение.
Исходя из условия задачи, было принято решение реализовать товарища Нечесова в виде сервера, а остальных товарищей в
виде клиента (точнее, объединить их в один клиент, так как по факту их действия мог выполнять и один человек).

Собственно в файле сервера мы создаем все необходимые переменные для работы, но самое главное - создается
непосредственно сокет и с помощью команды `bind` привязывается к адресу (в нашем случае это localhost - по факту было бы
логично сделать так, что на одном компьютере локально (с возможностью подключения с других компьютеров) запускается
сервер, а уже с других компьютеров к этому серверу можно подключаться - поэтому в программе сервера в качестве
аргументов командной строки я не добавлял адрес). Далее запускается команда `listen`, которая слушает входящие
соединения.

Далее запускается бесконечный цикл, в котором принимаются входящие соединения (от тех самых клиентов), а чтобы можно
было работать с несколькими, создается новый поток. В методе создания потока также указывается метод, который выполняет
поставленную задачу - `handle_client`.

С программой клиента всё чуть проще, так как не нужно создавать потоки. Создается сокет, осуществляется подключение к
серверу и через буфер происходит передача данных (в том числе и информация о стоимости товаров - она высчитывается
случайным образом).

Демонстрация работы программы - в видео.

P.S. на всякий случай скажу, что в терминале выводится не общая стоимость всех товаров, а стоимость каждого конкретного
товара.